/**
 * IT Center Portal - Complete Translations
 * UZ (O'zbek) <-> EN (English)
 * 100% Complete Coverage
 */

const textMap = {
    // === U+2018 VARIANTS (exact HTML matches) ===
    "Yo'nalishlar": "Directions",
    "To'lov": "Payment",
    "Manzil & To'lov": "Address & Payment",
    "Ro'yxatdan o'tish": "Register",
    "O'qish jarayoni qanday?": "How does learning work?",
    "Ko'p beriladigan savollar": "Frequently Asked Questions",
    "tayyor yo'l xaritasi.": "a ready roadmap for portfolio.",

    // === NAVIGATION (U+2018 LEFT SINGLE QUOTATION MARK from HTML) ===
    "Portal": "Portal",
    "Yo'nalishlar": "Directions",
    "Yo'nalishlar": "Directions",
    "Kurslar": "Courses",
    "Mentorlar": "Mentors",
    "Jarayon": "Process",
    "Jadval": "Schedule",
    "Yozilish": "Enroll",
    "Natijalar": "Results",
    "FAQ": "FAQ",
    "To'lov": "Payment",
    "To'lov": "Payment",
    "Manzil & To'lov": "Address & Payment",
    "Manzil & To'lov": "Address & Payment",
    "Kirish": "Login",
    "Ro'yxatdan o'tish": "Register",
    "Ro'yxatdan o'tish": "Register",

    // === LOADER ===
    "Yuklanmoqdaâ€¦": "Loading...",
    "Yuklanmoqda...": "Loading...",

    // === HEADER ===
    "Bosh sahifaga qaytish": "Return to home page",
    "Kun/Tun rejimi": "Day/Night mode",
    "Bildirishnomalar": "Notifications",
    "Tilni almashtirish": "Change language",
    "Menyuni ochish": "Open menu",

    // === HERO SECTION ===
    "O'zbekiston bo'yicha yagona raqamli IT portal": "The only digital IT portal in Uzbekistan",
    "IT Center â€”": "IT Center â€”",
    "frontend": "frontend",
    "backend, dizayn va": "backend, design and",
    "boshqa yo'nalishlar uchun zamonaviy o'quv markazi": "other directions in a modern learning center",
    "Talabalar shaxsiy kabinet, dars jadvali, materiallar va": "Students see personal cabinet, class schedule, materials and",
    "to'lovlarni ko'radi. Admin esa kurslar, guruhlar, mentorlar va": "payments. Admin manages courses, groups, mentors and",
    "o'quvchilarni boshqaradi â€” barchasi bitta tizimda.": "students â€” all in one system.",
    "Kurslarni ko'rish": "View Courses",
    "Tez ariza": "Quick Application",
    "500+": "500+",
    "bitiruvchilar": "graduates",
    "90% ishga": "90%",
    "joylashish ko'rsatkichi": "job placement",
    "Online": "Online",
    "to'lov imkoniyati": "payment",

    // === GLOBE HUD ===
    "Live network globe": "Live network globe",
    "Interaktiv 3D Globe animatsiyasi": "Interactive 3D Globe animation",
    "Talabalar": "Students",
    "faol": "active",
    "Guruhlar": "Groups",
    "aktiv": "active",
    "mentor": "mentors",
    "Sichqoncha bilan": "Use mouse to",
    "drag": "drag",
    "qiling â€” globeni aylantiring.": "â€” rotate the globe.",
    "Scroll â€” zoom.": "Scroll â€” zoom.",

    // === TRACKS SECTION ===
    "Qaysi yo'nalish sizga mosligini tanlang â€” portal sizni kerakli": "Choose the direction that suits you â€” the portal connects you to",
    "kurslarga ulaydi.": "courses.",
    "Zero â†’ Hero Frontend": "Zero â†’ Hero Frontend",
    "HTML, CSS, JavaScript, React. Noldan boshlab haqiqiy web-saytlar": "HTML, CSS, JavaScript, React. Create real websites from scratch",
    "yaratish.": ".",
    "UI dizayn va responsive layoutlar": "UI design and responsive layouts",
    "Git & GitHub, teamwork": "Git & GitHub, teamwork",
    "3+ portfolio loyihalar": "3+ portfolio projects",
    "O'rta daraja": "Intermediate Level",
    "Python & Backend": "Python & Backend",
    "Botlar, API'lar, server tomoni va ma'lumotlar bazasi bilan": "Bots, APIs, server-side and database",
    "ishlash.": "development.",
    "Flask / FastAPI": "Flask / FastAPI",
    "SQL / NoSQL asoslari": "SQL / NoSQL fundamentals",
    "Authentication & xavfsizlik": "Authentication & security",
    "Kids IT": "Kids IT",
    "Bolalar uchun IT": "IT for Kids",
    "Scratch, o'yinlar, robototexnika va mantiqiy fikrlashni": "Scratch, games, robotics and logical thinking",
    "rivojlantirish.": "development.",
    "9â€“14 yosh uchun maxsus dastur": "Special program for ages 9â€“14",
    "Gamification va badge tizimi": "Gamification and badge system",
    "Ota-onalar uchun hisobotlar": "Reports for parents",

    // === COURSES SECTION ===
    "Eng mashhur kurslar": "Most Popular Courses",
    "Har bir kurs bo'yicha batafsil ma'lumot va guruh jadvalini portal": "Detailed info and group schedule for each course",
    "orqali ko'rasiz.": "available in portal.",
    "Daraja bo'yicha filtrlash": "Filter by Level",
    "Kurs nomi bo'yicha qidirish": "Search by course name",
    "Masalan: Frontend, Python...": "Example: Frontend, Python...",
    "Barchasi": "All",
    "Boshlang'ich": "Beginner",
    "O'rta": "Intermediate",
    "Yuqori": "Advanced",
    "Kurs qidirish...": "Search course...",
    "oy": "months",
    "so'm": "UZS",
    "Web dasturlash (Frontend)": "Web Development (Frontend)",
    "Boshlang'ich â†’ Junior": "Beginner â†’ Junior",
    "Davomiyligi: 4 oy": "Duration: 4 months",
    "Davomiyligi: 3 oy": "Duration: 3 months",
    "Davomiyligi: 2 oy": "Duration: 2 months",
    "HTML, CSS, JavaScript, React": "HTML, CSS, JavaScript, React",
    "3+ portfolio": "3+ portfolio",
    "Live code": "Live code",
    "Mentor review": "Mentor review",
    "Batafsil ma'lumot": "Learn more",
    "Python dasturlash asoslari": "Python Programming Basics",
    "0 dan boshlovchilar uchun": "For absolute beginners",
    "Algoritmlar, botlar, backend": "Algorithms, bots, backend",
    "Mini-loyihalar": "Mini-projects",
    "Amaliyot": "Practice",
    "Testlar": "Tests",
    "Bolalar uchun IT (9â€“14 yosh)": "IT for Kids (9â€“14 years)",
    "Scratch, o'yinlar, robototexnika": "Scratch, games, robotics",
    "Gamification": "Gamification",
    "Badge": "Badge",
    "Hisobot": "Report",
    "Smart tavsiya tizimi": "Smart Recommendation System",
    "Qaysi kursni tanlashni bilmayapsizmi? Portal ichidagi tavsiya": "Not sure which course? The recommendation system",
    "tizimi siz uchun mos yo'nalishni tanlab beradi.": "will help you find the right direction.",
    "Kurs tanlashga yordam ber": "Help me choose a course",
    "Boshlang'ichlar uchun alohida": "Separate groups for",
    "guruhlar": "beginners",
    "Qayta o'qish kafolati": "Retake guarantee",
    "Onlayn va oflayn variantlar": "Online and offline options",

    // === MENTORS SECTION ===
    "Mentorlarimiz": "Our Mentors",
    "Har bir mentor â€” real tajriba va amaliy ko'nikmalar. 9 ta mentor": "Each mentor has real experience. 9 mentors",
    "Har bir mentor â€” real tajriba va amaliy koÊ»nikmalar. 9 ta mentor": "Each mentor has real experience. 9 mentors",
    "rotatsiya animatsiyasi bilan.": "with rotation animation.",
    "Professionallar jamoasi â€” ularga ishoningiz mumkin.": "Team of professionals you can trust.",
    "Profil": "Profile",
    "review": "reviews",
    "Oldingi": "Previous",
    "Keyingi": "Next",

    // === PROCESS SECTION ===
    "O'qish jarayoni qanday?": "How does learning work?",
    "OÊ»qish jarayoni qanday?": "How does learning work?",
    "Oddiy": "Not just",
    "emas â€” real loyiha, mentor nazorati va portfelga": "â€” real projects, mentor supervision and",
    "tayyor yo'l xaritasi.": "a ready roadmap for portfolio.",
    "tayyor yoÊ»l xaritasi.": "a ready roadmap for portfolio.",
    "Diagnostika": "Diagnostics",
    "Darajangiz aniqlanadi va mos guruh tavsiya qilinadi.": "Your level is determined and suitable group recommended.",
    "5â€“10 daqiqa": "5â€“10 minutes",
    "Foundation": "Foundation",
    "Asosiy konseptlar: algoritm, mantiq, UI/UX va amaliy mashqlar.": "Core concepts: algorithms, logic, UI/UX and practice.",
    "1â€“3 hafta": "1â€“3 weeks",
    "Practice Lab": "Practice Lab",
    "Har darsda mini-topshiriqlar va real case'lar.": "Mini-tasks and real cases every lesson.",
    "Doimiy": "Ongoing",
    "Portfolio Build": "Portfolio Build",
    "3+ loyiha: landing, dashboard, API, mini-app.": "3+ projects: landing, dashboard, API, mini-app.",
    "2â€“8 hafta": "2â€“8 weeks",
    "Mentor Review": "Mentor Review",
    "Code review, refactor, best practices.": "Code review, refactor, best practices.",
    "Har hafta": "Every week",
    "Interview Prep": "Interview Prep",
    "CV, GitHub, test tasks va mock interview.": "CV, GitHub, test tasks and mock interview.",
    "Final": "Final",

    // === SCHEDULE SECTION ===
    "Haftalik dars jadvali": "Weekly Class Schedule",
    "Kurslar bo'yicha namuna jadval. Real jadval talaba kabinetida": "Sample schedule. Real schedule in student cabinet",
    "ko'rinadi.": "available.",
    "Dushanba": "Monday",
    "Seshanba": "Tuesday",
    "Chorshanba": "Wednesday",
    "Payshanba": "Thursday",
    "Juma": "Friday",
    "Shanba": "Saturday",
    "Yakshanba": "Sunday",
    "Dam olish": "Day off",
    "HTML/CSS Lab": "HTML/CSS Lab",
    "JS Basics": "JS Basics",
    "Layout Drill": "Layout Drill",
    "DOM & Events": "DOM & Events",
    "Mini Project": "Mini Project",
    "React Intro": "React Intro",
    "Components": "Components",
    "Quiz / Test": "Quiz / Test",
    "Support": "Support",
    "Workshop": "Workshop",

    // === ENROLLMENT SECTION ===
    "Kursga yozilish (tez ariza)": "Course Enrollment (Quick Application)",
    "Portal orqali to'liq ro'yxatdan o'tishga ulgurmasangiz, qisqa": "If you don't have time for full registration,",
    "Portal orqali toÊ»liq roÊ»yxatdan oÊ»tishga ulgurmasangiz, qisqa": "If you don't have time for full registration,",
    "arizani to'ldiring â€” menejerlar SMS va qo'ng'iroq orqali": "fill short application â€” managers will contact via",
    "arizani toÊ»ldiring â€” menejerlar SMS va qoÊ»ngÊ»iroq orqali": "fill short application â€” managers will contact via",
    "bog'lanadi.": "SMS and phone.",
    "bogÊ»lanadi.": "SMS and phone.",
    "Formani to'ldiring â€” biz sizga mos kurs va jadval tavsiya qilamiz.": "Fill the form â€” we'll recommend suitable course.",
    "Birinchi tanishuv darsi â€” bepul": "First introductory lesson â€” free",
    "Darajangiz aniqlanadi va mos guruh tanlanadi.": "Your level determined, suitable group selected.",
    "Orqada qolmaslik uchun support va qayta darslar.": "Support and make-up classes so you don't fall behind.",
    "Mentor nazorati": "Mentor supervision",
    "Har haftalik code review va tavsiyalar.": "Weekly code review and recommendations.",
    "SMS tasdiqlash": "SMS confirmation",
    "ariza yuborilgach, telefoningizga": "after submitting, your phone receives",
    "xabarnoma boradi.": "notification.",
    "To'liq ismingiz": "Your full name",
    "Ism Familiya": "Full Name",
    "Ism": "Name",
    "Telefon raqamingiz": "Your phone number",
    "Telefon": "Phone",
    "+998 __ ___ __ __": "+998 __ ___ __ __",
    "Qaysi kurs sizni qiziqtiradi?": "Which course interests you?",
    "Kurs": "Course",
    "Tanlang": "Select",
    "O'qish formati": "Study Format",
    "Oflayn": "Offline",
    "Onlayn": "Online",
    "Aralash": "Hybrid",
    "Qo'shimcha izoh (ixtiyoriy)": "Additional notes (optional)",
    "Masalan: qaysi vaqtda o'qish qulay, hozirgi darajangiz va hokazo.": "Example: preferred study time, current level, etc.",
    "SMS orqali bog'lanish va ma'lumotlarimni qayta ishlashga": "I agree to SMS contact and processing of",
    "roziman.": "my data.",
    "Arizani yuborish": "Submit Application",
    "Ariza yuborish": "Submit Application",
    "Ariza yuborildi âœ… Menejer SMS/qo'ng'iroq orqali bog'lanadi.": "Application submitted âœ… Manager will contact via SMS/call.",

    // === RESULTS SECTION ===
    "Bitiruvchilar natijalari": "Graduate Results",
    "Real portfel, real ish, real ko'nikma. Natijalar â€” bizning": "Real portfolio, real job, real skills. Results â€” our",
    "standart.": "standard.",
    "Raqamlarda natijalar": "Results in Numbers",
    "850+": "850+",
    "Bitiruvchilar": "Graduates",
    "95%": "95%",
    "Ishga joylashgan": "Employed",
    "Ishga joylashish (%)": "Job Placement (%)",
    "45+": "45+",
    "Aktiv guruhlar": "Active Groups",
    "Real loyihalar": "Real Projects",
    "12": "12",
    "Mentorlar": "Mentors",
    "Portfolio tekshiruvi:": "Portfolio review:",
    "mentorlar GitHub va Figma": "mentors review GitHub and Figma",
    "ishlaringizni real kompaniya standartida tekshiradi.": "work to real company standards.",
    "Alumni stories": "Alumni Stories",
    "Qisqa feedbacklar (demo). Real tizimda verifikatsiya qilinadi.": "Short feedbacks (demo). Verified in real system.",
    "â€” Ota-ona fikri": "â€” Parent's opinion",

    // === FAQ SECTION ===
    "Ko'p beriladigan savollar": "Frequently Asked Questions",
    "KoÊ»p beriladigan savollar": "Frequently Asked Questions",
    "Eng ko'p so'raladigan savollar â€” bir joyda.": "Most asked questions â€” in one place.",
    "Eng koÊ»p soÊ»raladigan savollar â€” bir joyda.": "Most asked questions â€” in one place.",
    "Savollaringizga javoblar.": "Answers to your questions.",
    "Ro'yxatdan o'tish qanday tasdiqlanadi?": "How is registration confirmed?",
    "RoÊ»yxatdan oÊ»tish qanday tasdiqlanadi?": "How is registration confirmed?",
    "Tasdiqlash": "Confirmation",
    "faqat SMS": "only via SMS",
    "orqali amalga oshiriladi. Telefon": "is done. Your phone",
    "raqamingizga kod yuboriladi.": "will receive a code.",
    "Kurs jadvali qayerda ko'rinadi?": "Where can I see the course schedule?",
    "Real jadval talaba shaxsiy kabinetiga kirgach ko'rinadi. Bu": "Real schedule visible after logging into cabinet. This",
    "sahifada namuna jadval berilgan.": "page shows sample schedule.",
    "Kurslarga qanday yozilaman?": "How do I enroll in courses?",
    "Saytdagi ariza formasini to'ldiring yoki qo'ng'iroq qiling.": "Fill application form on site or call us.",
    "Online o'qish imkoniyati bormi?": "Is online learning available?",
    "Ha, barcha kurslar onlayn va oflayn formatda mavjud.": "Yes, all courses available online and offline.",
    "Online to'lov qilsa bo'ladimi?": "Can I pay online?",
    "Ha. Online to'lovdan oldin o'quvchi haqida to'liq ma'lumot": "Yes. Before online payment, full student info is",
    "olinadi, so'ng to'lov usuli tanlanadi.": "collected, then payment method selected.",
    "To'lov qanday amalga oshiriladi?": "How is payment made?",
    "Click, Payme, Uzcard, Humo orqali online yoki naqd.": "Via Click, Payme, Uzcard, Humo online or cash.",
    "Admin panelga kirish qayerdan?": "Where to access admin panel?",
    "Admin panelga kirish faqat \"Kirish\" oynasi orqali â€” maxsus": "Admin access only through 'Login' â€” with special",
    "login/parol bilan. Alohida tugma yo'q.": "login/password. No separate button.",
    "Sertifikat beriladimi?": "Is certificate provided?",
    "Ha, kurs yakunida rasmiy sertifikat beriladi.": "Yes, official certificate issued on completion.",
    "Bolalar uchun kurslar bormi?": "Are there courses for kids?",
    "Ha, 9â€“14 yosh uchun Kids IT dasturi mavjud.": "Yes, Kids IT program for ages 9â€“14.",

    // === PAYMENT SECTION ===
    "To'lov usullari": "Payment Methods",
    "Online to'lovni qulay va xavfsiz amalga oshiring. Click, Payme, Uzcard va Humo orqali to'lash mumkin.": "Make secure online payments. Pay via Click, Payme, Uzcard and Humo.",
    "Click": "Click",
    "Tez va qulay": "Fast and convenient",
    "Payme": "Payme",
    "Ishonchli xizmat": "Reliable service",
    "Uzcard": "Uzcard",
    "Milliy karta": "National card",
    "Humo": "Humo",
    "O'zbek kartasi": "Uzbek card",
    "Online to'lov": "Online Payment",
    "To'lov ma'lumotlarini kiriting": "Enter payment details",
    "O'quvchi F.I.Sh": "Student Full Name",
    "To'liq ism-familiya": "Full name",
    "Telefon raqam": "Phone Number",
    "To'lov miqdori (so'm)": "Amount (UZS)",
    "To'lov usuli": "Payment Method",
    "Usulni tanlang": "Select method",
    "Kursni tanlang": "Select course",
    "Frontend dasturlash": "Frontend Development",
    "Python dasturlash": "Python Development",
    "UI/UX Dizayn": "UI/UX Design",
    "Mobile dasturlash": "Mobile Development",
    "To'lovga o'tish": "Proceed to Payment",
    "To'lovni davom ettirish (demo)": "Continue Payment (demo)",
    "Hozircha demo rejimda. Real to'lov integratsiyasi tez orada qo'shiladi.": "Demo mode. Real payment integration coming soon.",
    "Hozircha demo rejimda. Real to'lov tez orada.": "Demo mode. Real payments coming soon.",
    "SSL himoyalangan": "SSL Protected",
    "Xavfsiz to'lov": "Secure Payment",
    "Tez tasdiqlash": "Fast Confirmation",

    // === BRANCHES SECTION ===
    "Bizning filiallar": "Our Branches",
    "Sizga qulay joylashgan filialimizga tashrif buyuring yoki onlayn bog'laning": "Visit our branch or connect online",
    "Ochiq": "Open",
    "Yopiq": "Closed",
    "Markaz filial": "Main Branch",
    "Shimol filial": "North Branch",
    "Janub filial": "South Branch",
    "IT Park binosi, 2-qavat, 205-xona. Shahar markazi.": "IT Park building, 2nd floor, room 205. City center.",
    "Savdo Markazi yonida, asosiy ko'cha, 45-uy.": "Near Shopping Center, main street, building 45.",
    "Stadion yonida, sport kompleksi binosi, 1-qavat.": "Near stadium, sports complex, 1st floor.",
    "09:00 â€“ 20:00 (Dushanba â€“ Shanba)": "09:00 â€“ 20:00 (Mon â€“ Sat)",
    "10:00 â€“ 19:00 (Dushanba â€“ Juma)": "10:00 â€“ 19:00 (Mon â€“ Fri)",
    "09:00 â€“ 18:00 (Dushanba â€“ Shanba)": "09:00 â€“ 18:00 (Mon â€“ Sat)",
    "Qo'ng'iroq": "Call",
    "Xaritada": "On Map",
    "09:00 - 21:00": "09:00 - 21:00",
    "09:00 - 20:00": "09:00 - 20:00",
    "10:00 - 19:00": "10:00 - 19:00",
    "Barcha filiallarda bepul sinov darsi mavjud!": "Free trial lesson at all branches!",

    // === FOOTER ===
    "IT Center â€” zamonaviy kasblar uchun zamonaviy ta'lim. Biz bilan IT olamiga qadam qo'ying.": "IT Center â€” modern education for modern careers.",
    "Talaba va adminlar uchun yagona boshqaruv ekotizimi.": "Management ecosystem for students and admins.",
    "Sahifalar": "Pages",
    "Bosh sahifa": "Home",
    "Aloqa": "Contact",
    "Manzil:": "Address:",
    "Nukus, IT Park": "Nukus, IT Park",
    "Â© 2024 IT Center. Barcha huquqlar himoyalangan.": "Â© 2024 IT Center. All rights reserved.",
    "Barcha huquqlar himoyalangan.": "All rights reserved.",

    // === AUTH MODAL ===
    "Shaxsiy kabinetga kirish": "Login to Personal Cabinet",
    "Ma'lumotlaringizni kiriting": "Enter your credentials",
    "Yangi akkaunt yarating": "Create a new account",
    "Email": "Email",
    "Parol": "Password",
    "Parolingiz": "Your password",
    "Parolni tasdiqlang": "Confirm Password",
    "Parolni qayta kiriting": "Re-enter password",
    "Parol yarating": "Create password",
    "Qaysi kursga?": "Which course?",
    "Parolni unutdingizmi?": "Forgot password?",
    "Eslab qolish": "Remember me",
    "Kirish (demo)": "Login (demo)",
    "Ro'yxatdan o'tish (demo)": "Register (demo)",
    "Talaba kabineti yoki admin boshqaruvi": "Student cabinet or admin management",
    "Telefon yoki email": "Phone or email",
    "+998â€¦ yoki email": "+998â€¦ or email",
    "Portalga kirish": "Login to Portal",
    "Admin uchun: login/parol kiritilganda avtomatik admin panelga": "For admin: auto-redirect to admin panel",
    "yo'naltiriladi.": "when login entered.",
    "Telefon (SMS tasdiqlash)": "Phone (SMS verification)",
    "Tug'ilgan sana": "Date of birth",
    "Yo'nalish": "Direction",
    "Manzil (ixtiyoriy)": "Address (optional)",
    "Shahar / tuman": "City / district",
    "SMS orqali tasdiqlashga va ma'lumotlarimni qayta ishlashga": "I agree to SMS verification and processing of",
    "Yordam": "Help",
    "Yopish": "Close",

    // === RECOMMENDATION MODAL ===
    "Kurs tavsiya tizimi": "Course Recommendation System",
    "2 ta savol â€” mos kursni tavsiya qilamiz.": "2 questions â€” we'll recommend the right course.",
    "Daraja": "Level",
    "Noldan": "From zero",
    "Maqsad": "Goal",
    "Boshlash": "Start",
    "Ish topish": "Find a job",
    "Ko'nikmani kuchaytirish": "Improve skills",
    "Tavsiya olish": "Get Recommendation",

    // === ALUMNI STORIES ===
    "4 oy": "4 months",
    "3 oy": "3 months",
    "2 oy": "2 months",
    "Portfolio bilan ishga kirdim. Mentor review juda kuchli.": "I got a job with my portfolio. Mentor review was very helpful.",
    "FastAPI + DB ni amalda qildik. Hamma narsasi tushunarli.": "We practiced FastAPI + DB. Everything was clear.",
    "Case study va DS. Dizaynim haqiqiy productga o'xshab": "Case study and DS. My design looks like a real",
    "qoldi.": "product.",
    "Bolam mantiqiy fikrlashni o'rgandi, motivatsiya juda": "My child learned logical thinking, motivation was very",
    "kuchli.": "strong.",

    // === FAQ BODY TEXT ===
    "orqali amalga oshiriladi. Telefon": "is done. Your phone",
    "Ha.": "Yes.",
    "Ha": "Yes",

    // === AUTH MODAL ===
    "+998â€¦ yoki email": "+998â€¦ or email",
    "Parol yarating": "Create password",
    "Parolni qayta kiriting": "Re-enter password",
    "Shahar / tuman": "City / district",
    "Â© 2025 IT Center": "Â© 2025 IT Center",

    // === BRANCH INFO ===
    "Dushanba â€“ Shanba": "Mon â€“ Sat",
    "Dushanba â€“ Juma": "Mon â€“ Fri",

    // === COMMON ===
    "yosh": "years old",
    "hafta": "weeks",
    "Batafsil": "Details",
    "dars": "lesson",
    "â€¢ ": "â€¢ "
};

let originalTexts = new Map();
let originalPlaceholders = new Map();
let originalOptions = new Map();
let currentLang = "UZ";

// OPTIMIZATION: Cache for faster lookups
let translationCache = new Map();
let debounceTimer = null;
const DEBOUNCE_DELAY = 50;

// Build cache on first use
function buildTranslationCache() {
    if (translationCache.size > 0) return;

    const sortedKeys = Object.keys(textMap).sort((a, b) => b.length - a.length);
    sortedKeys.forEach(key => {
        translationCache.set(key, textMap[key]);
    });
    console.log(`âœ… Translation cache built: ${translationCache.size} entries`);
}

function getTextNodes(el) {
    const nodes = [];
    const walker = document.createTreeWalker(el, NodeFilter.SHOW_TEXT, {
        acceptNode: (n) => {
            const p = n.parentElement;
            if (!p || p.tagName === "SCRIPT" || p.tagName === "STYLE" || p.tagName === "NOSCRIPT")
                return NodeFilter.FILTER_REJECT;
            if (!n.textContent.trim()) return NodeFilter.FILTER_REJECT;
            return NodeFilter.FILTER_ACCEPT;
        }
    });
    let n;
    while (n = walker.nextNode()) nodes.push(n);
    return nodes;
}

function applyTranslations(lang) {
    if (lang === currentLang) return;

    try {
        if (lang === "EN") {
            // Normalize apostrophes function
            function normalizeApostrophes(text) {
                return text
                    .replace(/[\u2018\u2019\u02BB\u02BC]/g, "'")  // Unicode apostrophes to standard
                    .replace(/Ê»/g, "'")  // Modifier letter turned comma (backup)
                    .replace(/Ê¼/g, "'"); // Modifier letter apostrophe (backup)
            }

            // Create normalized textMap with both versions
            const normalizedTextMap = {};
            for (const [uzKey, enValue] of Object.entries(textMap)) {
                normalizedTextMap[uzKey] = enValue;
                const normalized = normalizeApostrophes(uzKey);
                if (normalized !== uzKey) {
                    normalizedTextMap[normalized] = enValue;
                }
            }

            // Sort keys by length (longest first) to avoid partial replacements
            const sortedKeys = Object.keys(normalizedTextMap).sort((a, b) => b.length - a.length);

            // Smart replacement function - avoids replacing parts of words
            function smartReplace(text) {
                // CRITICAL: Normalize the incoming text to handle Unicode apostrophes
                const normalizedText = normalizeApostrophes(text);
                let result = normalizedText;
                for (const uz of sortedKeys) {
                    if (!result.includes(uz)) continue;

                    // Create a regex that:
                    // 1. Matches the exact phrase
                    // 2. Uses word boundaries for single words
                    // 3. Allows punctuation and spaces around phrases
                    const isMultiWord = uz.includes(' ');
                    const escapedUz = uz.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');

                    if (isMultiWord) {
                        // For phrases, replace exactly
                        const regex = new RegExp(escapedUz, 'g');
                        result = result.replace(regex, normalizedTextMap[uz]);
                    } else {
                        // For single words, use word boundaries but allow apostrophes
                        const regex = new RegExp(`(?<![-'\\w])${escapedUz}(?![-'\\w])`, 'g');
                        result = result.replace(regex, normalizedTextMap[uz]);
                    }
                }
                return result;
            }

            // Translate text nodes
            const nodes = getTextNodes(document.body);
            for (let i = 0; i < nodes.length; i++) {
                const node = nodes[i];
                const orig = node.textContent;
                const text = smartReplace(orig);
                if (text !== orig) {
                    originalTexts.set(node, orig);
                    node.textContent = text;
                }
            }

            // Translate placeholders
            document.querySelectorAll("[placeholder]").forEach(el => {
                const orig = el.placeholder;
                const text = smartReplace(orig);
                if (text !== orig) {
                    originalPlaceholders.set(el, orig);
                    el.placeholder = text;
                }
            });


            // Translate options
            document.querySelectorAll("select option").forEach(opt => {
                const orig = opt.textContent.trim();
                if (textMap[orig]) {
                    originalOptions.set(opt, orig);
                    opt.textContent = textMap[orig];
                }
            });

            // Translate aria-labels
            document.querySelectorAll("[aria-label]").forEach(el => {
                const orig = el.getAttribute("aria-label");
                if (textMap[orig]) {
                    el.setAttribute("data-orig-aria", orig);
                    el.setAttribute("aria-label", textMap[orig]);
                }
            });

            // Translate title
            document.title = "IT Center Portal â€” Student and Admin";

        } else {
            // Revert to UZ
            originalTexts.forEach((orig, node) => {
                if (node.parentElement) node.textContent = orig;
            });
            originalTexts.clear();

            originalPlaceholders.forEach((orig, el) => {
                if (el) el.placeholder = orig;
            });
            originalPlaceholders.clear();

            originalOptions.forEach((orig, opt) => {
                if (opt) opt.textContent = orig;
            });
            originalOptions.clear();

            // Revert aria-labels
            document.querySelectorAll("[data-orig-aria]").forEach(el => {
                el.setAttribute("aria-label", el.getAttribute("data-orig-aria"));
                el.removeAttribute("data-orig-aria");
            });

            document.title = "IT Center Portal â€” Talaba va Admin";
        }

        currentLang = lang;
        document.documentElement.lang = lang.toLowerCase();
    } catch (e) {
        console.error("Translation error:", e);
    }
}

window.__ITC_applyTranslations = applyTranslations;
window.__ITC_textMap = textMap;
window.__ITC_currentLang = () => currentLang;

// =====================================
// REAL-TIME TRANSLATION SYNC SYSTEM
// =====================================

// Load custom translations from localStorage
function loadCustomTranslations() {
    try {
        const customTranslations = JSON.parse(localStorage.getItem("itc_custom_translations") || "{}");
        const count = Object.keys(customTranslations).length;
        if (count > 0) {
            // Merge custom translations into textMap
            Object.assign(textMap, customTranslations);
            console.log(`âœ… Loaded ${count} custom translations from localStorage`);
        }
    } catch (e) {
        console.error("Error loading custom translations:", e);
    }
}

// Refresh translations (re-apply current language with updated textMap)
function refreshTranslations() {
    loadCustomTranslations();

    // Force re-apply by temporarily switching language
    const current = currentLang;
    if (current === "EN") {
        // First revert to UZ, then re-apply EN
        currentLang = "UZ"; // Force change detection
        originalTexts.forEach((orig, node) => {
            if (node.parentElement) node.textContent = orig;
        });
        originalTexts.clear();
        originalPlaceholders.forEach((orig, el) => {
            if (el) el.placeholder = orig;
        });
        originalPlaceholders.clear();
        originalOptions.forEach((orig, opt) => {
            if (opt) opt.textContent = orig;
        });
        originalOptions.clear();

        // Re-apply EN with new translations
        setTimeout(() => {
            applyTranslations("EN");
        }, 100);
    }
    console.log("ðŸ”„ Translations refreshed");
}

// Listen for localStorage changes from other tabs/windows (admin panel)
window.addEventListener("storage", (event) => {
    if (event.key === "itc_custom_translations" || event.key === "itc_translations_updated") {
        console.log("ðŸ“¡ Translation update detected from admin panel");
        refreshTranslations();
    }
});

// Load custom translations on page load
loadCustomTranslations();

// Expose refresh function globally
window.__ITC_refreshTranslations = refreshTranslations;
window.__ITC_loadCustomTranslations = loadCustomTranslations;
